{% extends "base.html" %}

{% block nav_actions %}
<a class="btn btn-outline-light btn-sm" href="/vault">Back</a>
<form method="post" action="/logout" class="m-0">
  <button class="btn btn-outline-light btn-sm" type="submit">Logout</button>
</form>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-9">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h1 class="h4 m-0">{% if mode == 'new' %}New entry{% else %}Edit entry{% endif %}</h1>
      {% if mode == 'edit' %}
      <form method="post" action="/vault/{{ entry.id }}/delete" onsubmit="return confirm('Delete this entry?');">
        <button class="btn btn-outline-danger btn-sm" type="submit">Delete</button>
      </form>
      {% endif %}
    </div>

    {% if error %}
      <div class="alert alert-danger" role="alert">{{ error }}</div>
    {% endif %}

    <div class="card shadow-sm">
      <div class="card-body p-4">
        <form method="post" action="/vault/save" autocomplete="off">
          <input type="hidden" name="entry_id" value="{% if entry %}{{ entry.id }}{% endif %}">

          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Site name</label>
              <input class="form-control" name="site_name" required value="{% if entry %}{{ entry.site_name }}{% endif %}">
            </div>
            <div class="col-md-6">
              <label class="form-label">Tags</label>
              <input class="form-control" name="tags" placeholder="work, personal" value="{{ tags }}">
            </div>
            <div class="col-12">
              <label class="form-label">URL</label>
              <input class="form-control" name="url" required value="{% if entry %}{{ entry.url }}{% endif %}">
            </div>
            <div class="col-md-6">
              <label class="form-label">Username / Email</label>
              <input class="form-control" name="login_username" required value="{% if entry %}{{ entry.login_username }}{% endif %}">
            </div>
            <div class="col-md-6">
              <label class="form-label">Password</label>
              <div class="input-group">
                <input id="vpPassword" class="form-control" type="password" name="password" required value="{{ password }}">
                <button class="btn btn-outline-secondary" type="button" onclick="VectorPass.togglePassword('vpPassword', this)">Show</button>
                {% if mode == 'edit' %}
                <button class="btn btn-outline-primary" type="button" data-entry-id="{{ entry.id }}" onclick="VectorPass.revealAndCopy(this)">Reveal & Copy</button>
                {% endif %}
              </div>
              <div class="form-text">Stored encrypted.</div>
            </div>
            <div class="col-12">
              <label class="form-label">Notes</label>
              <textarea class="form-control" name="notes" rows="4">{{ notes }}</textarea>
            </div>
          </div>

          <div class="mt-4 d-flex gap-2">
            <button class="btn btn-primary" type="submit">Save</button>
            {% if mode == 'edit' %}
              <a class="btn btn-outline-secondary" href="/vault/{{ entry.id }}/edit">Reset</a>
            {% else %}
              <a class="btn btn-outline-secondary" href="/vault">Cancel</a>
            {% endif %}
          </div>
        </form>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/vault.js"></script>
{% endblock %}
