<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>System Trace ¬∑ Host Monitor</title>
    <link rel="stylesheet" href="/static/assets/dashboard.css?v=20260221_3" />
    <link rel="stylesheet" href="/static/assets/host.css?v=20260221_5" />
    <link rel="stylesheet" href="/static/assets/logs.css?v=20260221_1" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script defer src="/static/assets/host.js?v=20260221_7"></script>
  </head>
  <body class="sidebarAutoHide">
    <div class="appShell">
      <aside class="sidebar" id="sidebar" aria-label="Navigation">
        <div class="sideTop">
          <div class="brandRow">
            <div class="brand">System Trace</div>
          </div>
          <div class="sideSearchWrap">
            <input id="sideSearch" class="sideSearch" placeholder="Search‚Ä¶" autocomplete="off" />
          </div>
        </div>

        <nav class="sideNav" id="sideNav" aria-label="Main">
          <div class="sideGroup">
            <div class="sideGroupTitle">Monitoring</div>
            <a class="sideItem" href="/" data-label="Dashboard">Dashboard</a>
            <a class="sideItem" href="/overview" data-label="Overview">Overview</a>
            <a class="sideItem" href="/#hosts" data-label="Hosts">Hosts</a>
            <a class="sideItem" href="/#maps" data-label="Maps">Maps</a>
          </div>

          <div class="sideGroup">
            <div class="sideGroupTitle">Configuration</div>
            <a class="sideItem" href="/configuration" data-label="Configuration">Configuration</a>
          </div>

          <div class="sideGroup">
            <div class="sideGroupTitle">Administration</div>
            <a class="sideItem" href="/logs" data-label="System Logs">System Logs</a>
            <a class="sideItem" href="/users" data-action="users" data-label="Users">Users</a>
            <a class="sideItem" href="/user-groups" data-action="user-groups" data-label="User groups">User groups</a>
          </div>
        </nav>

        <div class="sideBottom" aria-label="Secondary">
          <form class="sideLogout" method="post" action="/logout">
            <button class="sideItem sideBtn" type="submit">Sign out</button>
          </form>
        </div>
      </aside>

      <div class="content">
        <div class="hmWrap" id="hmWrap">

          <!-- Page header (id=hmWrap used by JS for blink class) -->
          <header class="hmHeader">
            <div class="hmHeaderLeft">
              <a class="hmBack" href="/#hosts">‚Üê Hosts</a>
              <div>
                <div class="hmTitle" id="hName">Loading‚Ä¶</div>
                <div class="hmSub"><span id="hAddr">‚Äî</span> &bull; <span id="hType">‚Äî</span> &bull; <span id="hOsType" class="muted">‚Äî</span></div>
              </div>
            </div>
            <div class="hmHeaderRight">
              <div class="hmAgentBadge" id="hmAgentBadge">‚Äî</div>
              <div class="hmConnBadge"><span class="dot"></span><span id="hostConn">loading‚Ä¶</span></div>
              <span class="muted" style="font-size:11px;" id="hostUser">‚Äî</span>
            </div>
          </header>

          <div id="hostErr" class="hostsErr" role="alert" style="display:none;"></div>

          <!-- Problem / error panel (shown only when issues detected) -->
          <div class="hmErrPanel" id="hmErrPanel" style="display:none;">
            <div class="hmErrPanelHeader">
              <div class="hmErrPanelTitle">
                <span class="hmErrBlink"></span>
                <span id="hmErrPanelTitle">Active Problems</span>
              </div>
              <a class="hmErrPanelLink" href="/logs" id="hmErrLogsLink">View all in System Logs ‚Üí</a>
            </div>
            <div class="hmErrList" id="hmErrList"></div>
          </div>

          <!-- Live stat tiles -->
          <div class="hmTiles" id="hmTiles">
            <div class="hmTile"><div class="hmTileLabel">CPU</div><div class="hmTileVal" id="tCpu">‚Äî</div></div>
            <div class="hmTile"><div class="hmTileLabel">RAM</div><div class="hmTileVal" id="tMem">‚Äî</div></div>
            <div class="hmTile"><div class="hmTileLabel">Disk</div><div class="hmTileVal" id="tDisk">‚Äî</div></div>
            <div class="hmTile"><div class="hmTileLabel">Net ‚Üë</div><div class="hmTileVal" id="tNetSent">‚Äî</div></div>
            <div class="hmTile"><div class="hmTileLabel">Net ‚Üì</div><div class="hmTileVal" id="tNetRecv">‚Äî</div></div>
            <div class="hmTile"><div class="hmTileLabel">Uptime</div><div class="hmTileVal" id="tUptime">‚Äî</div></div>
            <div class="hmTile"><div class="hmTileLabel">Processes</div><div class="hmTileVal" id="tProcs">‚Äî</div></div>
            <div class="hmTile" id="tGpuTile" style="display:none;"><div class="hmTileLabel">GPU</div><div class="hmTileVal" id="tGpu">‚Äî</div></div>
          </div>

          <!-- Charts grid -->
          <div class="hmChartsGrid" id="hmChartsGrid">
            <div class="hmChartCard">
              <div class="hmChartTitle">CPU Usage %</div>
              <div class="hmChartWrap"><canvas id="chartCpu"></canvas></div>
            </div>
            <div class="hmChartCard">
              <div class="hmChartTitle">RAM Usage %</div>
              <div class="hmChartWrap"><canvas id="chartMem"></canvas></div>
            </div>
            <div class="hmChartCard">
              <div class="hmChartTitle">Disk Usage %</div>
              <div class="hmChartWrap"><canvas id="chartDisk"></canvas></div>
            </div>
            <div class="hmChartCard hmChartWide">
              <div class="hmChartTitle">Network Throughput (bytes/s)</div>
              <div class="hmChartWrap"><canvas id="chartNet"></canvas></div>
            </div>
            <div class="hmChartCard" id="chartGpuCard" style="display:none;">
              <div class="hmChartTitle">GPU Usage %</div>
              <div class="hmChartWrap"><canvas id="chartGpu"></canvas></div>
            </div>
          </div>

          <!-- Bottom grid: protocols + identity -->
          <div class="hmBottomGrid">

            <section class="hostsCard">
              <div class="hostsCardTitle">Protocol Checks</div>
              <div class="hmProtoList">
                <div class="hmProtoRow"><span class="hmProtoName">ICMP</span><span class="hmProtoDesc muted">Reachability / latency</span><span class="hmProtoVal" id="pIcmp">‚Äî</span></div>
                <div class="hmProtoRow"><span class="hmProtoName">SSH</span><span class="hmProtoDesc muted">tcp/22 connectivity</span><span class="hmProtoVal" id="pSsh">‚Äî</span></div>
                <div class="hmProtoRow"><span class="hmProtoName">SNMP</span><span class="hmProtoDesc muted">udp/161 agent</span><span class="hmProtoVal" id="pSnmp">‚Äî</span></div>
                <div class="hmProtoRow"><span class="hmProtoName">NTP</span><span class="hmProtoDesc muted">udp/123 time sync</span><span class="hmProtoVal" id="pNtp">‚Äî</span></div>
                <div class="hmProtoRow"><span class="hmProtoName">DNS</span><span class="hmProtoDesc muted">Name resolution</span><span class="hmProtoVal" id="pDns">‚Äî</span></div>
              </div>
            </section>

            <section class="hostsCard">
              <div class="hostsCardTitle">Identity</div>
              <div class="cfgKv">
                <div class="cfgKvRow"><span class="k">Hostname: </span><span id="hNameKv" class="v">‚Äî</span></div>
                <div class="cfgKvRow"><span class="k">Address: </span><span id="hAddrKv" class="v">‚Äî</span></div>
                <div class="cfgKvRow"><span class="k">Type: </span><span id="hTypeKv" class="v">‚Äî</span></div>
                <div class="cfgKvRow"><span class="k">Tags: </span><span id="hTags" class="v">‚Äî</span></div>
                <div class="cfgKvRow"><span class="k">Agent ID: </span><span id="hAgentId" class="v">‚Äî</span></div>
                <div class="cfgKvRow"><span class="k">Last seen: </span><span id="hLastSeen" class="v">‚Äî</span></div>
                <div class="cfgKvRow"><span class="k">Created: </span><span id="hCreated" class="v">‚Äî</span></div>
              </div>
            </section>

            <section class="hostsCard">
              <div class="hostsCardTitle">Reachability</div>
              <div class="cfgKv">
                <div class="cfgKvRow"><span class="k">Status: </span><span id="hStatus" class="v">‚Äî</span></div>
                <div class="cfgKvRow"><span class="k">Latency: </span><span id="hLatency" class="v">‚Äî</span></div>
                <div class="cfgKvRow"><span class="k">Last check: </span><span id="hChecked" class="v">‚Äî</span></div>
                <div class="cfgKvRow"><span class="k">Message: </span><span id="hMsg" class="v">‚Äî</span></div>
              </div>
              <div style="margin-top:14px;">
                <a class="hostsBtnSmall" href="/#hosts">‚Üê Back to Hosts</a>
              </div>
            </section>

            <section class="hostsCard" id="hNotesCard">
              <div class="hostsCardTitle">Notes</div>
              <div id="hNotes" class="hostNotes muted">‚Äî</div>
            </section>

          </div><!-- hmBottomGrid -->

          <div class="hmNoAgent" id="hmNoAgent" style="display:none;">
            <div class="hmNoAgentIcon">üì°</div>
            <div class="hmNoAgentTitle">No agent data available</div>
            <div class="hmNoAgentSub">Install the monitoring agent on this host to see CPU, RAM, Disk and Network charts.</div>
            <a class="btn" href="/#hosts">Go to Hosts ‚Üí Install Agent</a>
          </div>

        </div><!-- hmWrap -->
      </div>
    </div>

    <style>
    /* Force auto-hide behavior for this page */
    body.sidebarAutoHide:not(.sidebarHover):not(.sidebarOpen) .sidebar {
      transform: translateX(calc(-100% + 14px)) !important;
      transition: transform 180ms ease !important;
    }
    
    body.sidebarAutoHide.sidebarHover .sidebar,
    body.sidebarAutoHide.sidebarOpen .sidebar {
      transform: translateX(0) !important;
      transition: transform 180ms ease !important;
    }
    
    body.sidebarAutoHide:not(.sidebarHover):not(.sidebarOpen) .sidebar::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, rgba(110, 231, 255, 0.1), transparent);
      border-right: 1px solid rgba(110, 231, 255, 0.2);
      pointer-events: none;
    }
    
    /* Ensure content adjusts properly */
    body.sidebarAutoHide .content {
      margin-left: 14px !important;
      transition: margin-left 180ms ease !important;
    }
    
    body.sidebarAutoHide.sidebarHover .content,
    body.sidebarAutoHide.sidebarOpen .content {
      margin-left: var(--side-w, 260px) !important;
    }
  </style>
    <script>
      // Simple auto-hide sidebar implementation
      (function() {
        let sidebarHover = false;
        let mouseTimer = null;
        
        function initAutoHide() {
          const sidebar = document.getElementById('sidebar');
          if (!sidebar) return;
          
          // Force the auto-hide class
          document.body.classList.add('sidebarAutoHide');
          
          // Mouse move handler
          function onMouseMove(e) {
            clearTimeout(mouseTimer);
            const x = e.clientX;
            
            if (x <= 30) {
              if (!sidebarHover) {
                sidebarHover = true;
                document.body.classList.add('sidebarHover');
              }
            } else if (x > 100) {
              if (sidebarHover) {
                sidebarHover = false;
                document.body.classList.remove('sidebarHover');
              }
            }
          }
          
          // Add event listener
          document.addEventListener('mousemove', onMouseMove, { passive: true });
          
          // Sidebar hover handlers
          sidebar.addEventListener('mouseenter', function() {
            sidebarHover = true;
            document.body.classList.add('sidebarHover');
          });
          
          sidebar.addEventListener('mouseleave', function() {
            sidebarHover = false;
            document.body.classList.remove('sidebarHover');
          });
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initAutoHide);
        } else {
          initAutoHide();
        }
      })();
    </script>
  </body>
</html>
