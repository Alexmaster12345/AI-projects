# =============================================================================
# Custom WAF Rules — IDs 1000-1999
# =============================================================================

# 1001 — Block requests with no User-Agent
SecRule &REQUEST_HEADERS:User-Agent "@eq 0" \
  "id:1001,phase:1,deny,status:400,log,msg:'Missing User-Agent header',tag:'custom/headers'"

# 1002 — Block known scanner/bot User-Agents (case-insensitive)
SecRule REQUEST_HEADERS:User-Agent \
  "@rx (?i)(nikto|sqlmap|nmap|masscan|zgrab|dirbuster|dirb|gobuster|nuclei|wfuzz|hydra|nessus|openvas|acunetix|appscan|burpsuite|havij|pangolin|w3af|skipfish|arachni)" \
  "id:1002,phase:1,deny,status:403,log,msg:'Scanner/bot UA: %{REQUEST_HEADERS.User-Agent}',tag:'custom/scanner'"

# 1003 — Block excessively long URIs
SecRule REQUEST_URI_RAW "@rx ^.{2049,}" \
  "id:1003,phase:1,deny,status:414,log,msg:'URI too long',tag:'custom/protocol'"

# 1004 — Block null bytes in URI/args
SecRule REQUEST_URI|ARGS "@rx \x00" \
  "id:1004,phase:1,deny,status:400,log,msg:'Null byte detected',tag:'custom/protocol'"

# 1005 — Block web shell filenames
SecRule REQUEST_URI \
  "@rx (?i)(c99|r57|webshell|b374k|wso|WSO|eval|passthru|base64_decode)\.(php|asp|aspx|jsp)" \
  "id:1005,phase:1,deny,status:403,log,msg:'Web shell: %{REQUEST_URI}',tag:'custom/webshell'"

# 1006 — Block directory traversal
SecRule REQUEST_URI|ARGS \
  "@rx (?:\.{2}[/\\]|[/\\]\.{2})" \
  "id:1006,phase:1,deny,status:400,log,msg:'Directory traversal',tag:'custom/lfi'"

# 1007 — Block RFI (http/ftp/php wrappers as include targets)
SecRule ARGS \
  "@rx (?i)(?:https?|ftp|php|data|zlib|glob|phar|expect|zip)://.{8,}" \
  "id:1007,phase:2,deny,status:403,log,msg:'RFI attempt: %{MATCHED_VAR}',tag:'custom/rfi'"

# 1008 — Block common web shell paths
SecRule REQUEST_URI \
  "@rx (?i)/(wp-admin|wp-login\.php|xmlrpc\.php|phpmyadmin|pma|adminer|manager/html|joomla|administrator)(/|$)" \
  "id:1008,phase:1,deny,status:403,log,msg:'Admin path blocked: %{REQUEST_URI}',tag:'custom/admin'"

# 1009 — Block hidden/sensitive files
SecRule REQUEST_URI \
  "@rx (?i)(?:/\.env|/\.git/|/\.htaccess|/\.htpasswd|/\.svn/|/\.DS_Store|/config\.php|/wp-config\.php)" \
  "id:1009,phase:1,deny,status:403,log,msg:'Sensitive file access: %{REQUEST_URI}',tag:'custom/sensitive'"

# 1040 — Block invalid Transfer-Encoding
SecRule REQUEST_HEADERS:Transfer-Encoding "!@rx ^(chunked|identity)$" \
  "id:1040,phase:1,deny,status:400,log,msg:'Invalid Transfer-Encoding: %{REQUEST_HEADERS.Transfer-Encoding}',tag:'custom/protocol'"
